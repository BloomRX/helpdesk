@model List<Helpdesk.Api.Models.Solicitacao>

@{
    ViewData["Title"] = "Solicitações";
    var categorias = ViewBag.Categorias as List<Helpdesk.Api.Models.Categoria> ?? new();
    var statusList = ViewBag.StatusList as Helpdesk.Api.Models.StatusSolicitacao[] ?? new Helpdesk.Api.Models.StatusSolicitacao[0];

    // Recupera os valores de filtro da query string
    var filtroCategoria = Context.Request.Query["categoriaId"].FirstOrDefault();
    var filtroStatus = Context.Request.Query["status"].FirstOrDefault();
    var filtroColaborador = Context.Request.Query["colaborador"].FirstOrDefault();
}

<h2>Solicitações</h2>

<form method="get" class="row g-2 mb-3">
    <div class="col-auto">
        <select name="categoriaId" class="form-select">
            <option value="">Todas Categorias</option>
            @foreach (var c in categorias)
            {
                <option value="@c.Id" selected="@(filtroCategoria == c.Id.ToString() ? "selected" : null)">
                    @c.Nome
                </option>
            }
        </select>
    </div>
    <div class="col-auto">
        <select name="status" class="form-select">
            <option value="">Todos Status</option>
            @foreach (var st in statusList)
            {
                <option value="@st" selected="@(filtroStatus == st.ToString() ? "selected" : null)">
                    @st
                </option>
            }
        </select>
    </div>
    <div class="col-auto">
        <input type="text" name="colaborador" class="form-control"
               placeholder="Colaborador" value="@filtroColaborador" />
    </div>
    <div class="col-auto">
        <button type="submit" class="btn btn-primary">Filtrar</button>
    </div>
</form>

<ul class="list-group">
    @foreach (var s in Model)
    {
        <li class="list-group-item position-relative">
            <a asp-action="Detalhes" asp-route-id="@s.Id" class="stretched-link text-decoration-none">
                <strong>@s.Titulo</strong>
            </a>
            <div>
                <small class="text-muted">
                    Categoria: @s.Categoria.Nome |
                    Status: @s.Status |
                    Por: @s.EmailUsuario em @s.DataAbertura.ToString("dd/MM/yyyy")
                </small>
            </div>
        </li>
    }
</ul>
